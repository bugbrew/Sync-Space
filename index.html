<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyncSpace Pro | Live Collaboration</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            background-image: radial-gradient(#d1d1d1 1px, transparent 1px);
            background-size: 30px 30px;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .toolbar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 12px 20px;
            border-radius: 24px;
            display: flex;
            gap: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            align-items: center;
            z-index: 1000;
        }

        .section {
            display: flex;
            align-items: center;
            gap: 10px;
            border-right: 1px solid #ddd;
            padding-right: 15px;
        }

        .section:last-child {
            border: none;
            padding-right: 0;
        }

        .color-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            transition: transform 0.2s;
        }

        .color-circle.active {
            border-color: #007bff;
            transform: scale(1.1);
        }

        .tool-btn {
            background: none;
            border: none;
            padding: 8px 14px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            border-radius: 12px;
            transition: 0.2s;
        }

        .tool-btn.active {
            background: #000;
            color: #fff;
        }

        .btn-danger {
            color: #ff4757;
        }

        .cursor {
            position: fixed;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            transition: 0.1s linear;
        }

        .cursor-label {
            position: absolute;
            top: 15px;
            left: 10px;
            background: #333;
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            white-space: nowrap;
        }

        .status-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 8px 15px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #2ed573;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <div class="status-badge">
        <div class="dot"></div><span>SyncSpace Live</span>
    </div>
    <div class="toolbar">
        <div class="section">
            <div class="color-circle active" style="background: #000;" onclick="setColor('#000000', this)"></div>
            <div class="color-circle" style="background: #ff4757;" onclick="setColor('#ff4757', this)"></div>
            <div class="color-circle" style="background: #1e90ff;" onclick="setColor('#1e90ff', this)"></div>
            <div class="color-circle" style="background: #2ed573;" onclick="setColor('#2ed573', this)"></div>
        </div>
        <div class="section">
            <button class="tool-btn active" id="pencilBtn" onclick="setTool('pencil', this)">Pencil</button>
            <button class="tool-btn" id="eraserBtn" onclick="setTool('eraser', this)">Eraser</button>
        </div>
        <div class="section">
            <button class="tool-btn btn-danger" onclick="clearCanvas()">Clear</button>
            <button class="tool-btn" onclick="downloadImage()" style="color: #007bff;">Export</button>
        </div>
    </div>
    <canvas id="whiteboard"></canvas>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const myName = prompt("Join SyncSpace as:") || "Guest";
        const socket = io("https://sync-space.onrender.com");
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let drawing = false, currentTool = 'pencil', currentColor = '#000000', lastPos = { x: 0, y: 0 };

        function drawLine(x0, y0, x1, y1, color, width, emit) {
            ctx.beginPath();
            if (color === '#ffffff' || (emit && currentTool === 'eraser')) {
                ctx.globalCompositeOperation = 'destination-out';
            } else {
                ctx.globalCompositeOperation = 'source-over';
            }
            ctx.moveTo(x0, y0); ctx.lineTo(x1, y1);
            ctx.strokeStyle = color; ctx.lineWidth = width;
            ctx.lineCap = 'round'; ctx.stroke();
            if (emit) socket.emit('drawing_data', { x0, y0, x1, y1, color, width });
        }

        canvas.addEventListener('mousedown', (e) => { drawing = true; lastPos = { x: e.clientX, y: e.clientY }; });
        canvas.addEventListener('mouseup', () => drawing = false);
        canvas.addEventListener('mousemove', (e) => {
            socket.emit('cursor_move', { x: e.clientX, y: e.clientY });
            if (!drawing) return;
            const w = currentTool === 'eraser' ? 40 : 3;
            const c = currentTool === 'eraser' ? '#ffffff' : currentColor;
            drawLine(lastPos.x, lastPos.y, e.clientX, e.clientY, c, w, true);
            lastPos = { x: e.clientX, y: e.clientY };
        });

        socket.on('connect', () => socket.emit('join_workspace', myName));
        socket.on('drawing_history', (h) => {
            h.forEach(s => drawLine(s.x0, s.y0, s.x1, s.y1, s.color, s.width, false));
            ctx.globalCompositeOperation = 'source-over';
        });
        socket.on('receive_drawing', (d) => {
            if (d.color === '#ffffff') ctx.globalCompositeOperation = 'destination-out';
            else ctx.globalCompositeOperation = 'source-over';
            drawLine(d.x0, d.y0, d.x1, d.y1, d.color, d.width, false);
            ctx.globalCompositeOperation = 'source-over';
        });
        socket.on('clear_board_ui', () => ctx.clearRect(0, 0, canvas.width, canvas.height));
        socket.on('receive_cursor', (data) => {
            let el = document.getElementById(data.id);
            if (!el) {
                el = document.createElement('div'); el.id = data.id; el.className = 'cursor';
                el.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 50%)`;
                const l = document.createElement('div'); l.className = 'cursor-label';
                el.appendChild(l); document.body.appendChild(el);
            }
            el.querySelector('.cursor-label').innerText = data.username;
            el.style.left = data.x + 'px'; el.style.top = data.y + 'px';
        });
        socket.on('user_disconnected', (id) => { const el = document.getElementById(id); if (el) el.remove(); });
        function setColor(c, el) { currentColor = c; setTool('pencil', document.getElementById('pencilBtn')); document.querySelectorAll('.color-circle').forEach(d => d.classList.remove('active')); el.classList.add('active'); }
        function setTool(t, el) { currentTool = t; document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
        function clearCanvas() { if (confirm("Clear board for all?")) socket.emit('clear_board'); }
        function downloadImage() { const a = document.createElement('a'); a.download = 'syncspace.png'; a.href = canvas.toDataURL(); a.click(); }
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    </script>
</body>

</html>